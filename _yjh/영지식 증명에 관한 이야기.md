---
title: 영지식 증명에 관한 이야기
date: 2022-05-23 14:48:00 +0900
tags: [암호학, 프로그래밍]
---

## 서론
 최근 **영지식 증명(zero-knowledge proof)**이라는 것에 대해 알게 되었다. 위키피디아를 인용해 설명하자면, 영지식 증명이란 **암호학에서 누군가가 상대방에게 어떤 사항(statement)이 참이라는 것을 증명할 때, 그 문장의 참 거짓 여부를 제외한 어떤 것도 노출되지 않는 interactive한 절차**를 뜻한다. 쉽게 말해서 양지식 증명을 이용하면 나의 비밀번호를 언급하지 않으면서도 내가 비밀번호를 안다는 사실을 증명할 수 있다는 것이다. 나중에 친구에게도 영지식 증명에 대해 알려주었는데 그때 이야기를 나누면서 나온 내용들을 이 글로 기록하고자 한다.

## 영지식 증명의 간단한 예시
 먼저 간단한 예시를 들어 영지식 증명이 어떤 방법으로 이루어지는지 설명해보겠다. 

 철수(검증자)와 영희(증명자) 두 사람이 있고 영희가 공 두 개를 가지고 있다고 하자. 두 공은 각각 빨간색과 초록색 둘 중 하나이며 두 공의 색은 서로 같을 수도 있고 그렇지 않을 수도 있다. 영희는 자신이 가지고 있는 두 공이 서로 다른 색이라고 주장하는데, 이때 철수가 공의 색을 알지 못한 채로 두 공의 색이 다르다는 것을 납득할 수 있는 방법이 있을까?

 이 문제에 대한 해결책은 바로 불투명한 컵을 두 개 가지고 와서 다음의 세 단계로 이루어진 프로토콜을 반복하는 것이다.

---

1. 영희가 두 공을 각각 컵에 넣어서 뒤집은채로 철수에게 넘긴다.

2. 영희는 뒤돌아서 기다리고 철수는 두 컵의 위치를 바꾸거나 혹은 바꾸지 않는다.

3. 영희가 컵을 열고 공을 확인하여 컵의 위치가 바뀌었는지 안 바뀌었는지 철수에게 알려준다.

---

 만약 두 공의 색이 다르다면 영희는 두 컵의 위치가 바뀌었을 때 항상 이를 알고 철수에게 올바르게 대답할 수 있지만 두 공의 색이 같다면 50% 확률로 찍어서 대답해야 한다. 따라서 위의 행동을 철수가 원하는 만큼 반복해주고 도중에 영희가 대답에 오류가 발견되지 않는다면 매우 높은 확률로 영희의 말이 진실임을 믿을 수 있는데, 예를 들어 40번만 반복해도 영희가 거짓말을 성공적으로 칠 확률은 1조 분의 1보다도 작아진다. 사실 엄밀히 따지자면 논리적인 증명이라기보다는 확률에 의존하는 방식이기는 하다. **설명하는 곳에 따라 컵을 사용하지 않고 철수가 적녹색맹이라 빨간색 공과 초록색 공을 구분할 수 없다고 가정하기도 하는데, 핵심은 철수는 공의 색을 구분해서는 안된다는 것이다.**

## 만약 공의 색이 같은 경우를 증명해야 한다면?
 친구와 처음에 나누었던 이야기 중 하나가, 위의 예시로 말하자면 두 공의 색이 같은 경우를 증명하는 것이 가능한지였다. 물론 당연히 결론은 기본적으로는 불가능하다는 것이었는데, 영희가 거짓말을 하는 것을 알 방법이 없기 때문이다. 하지만 전제조건을 하나 더 추가한다면 두 공의 색이 동일하다는 것을 증명할 수 있다는 것을 구글링을 통해 알게 되었다. 그 방법은 다음과 같은데, 이미 서로 다른 색이라는 것이 검증된 한 쌍의 공을 추가해 증명하는 방법이다.

 앞의 예시처럼 철수와 영희가 등장하는데, 설명을 쉽게 하기 위해 컵을 쓰는 대신 철수가 적녹색맹이라 빨간색 공과 초록색 공을 구분할 수 없다고 가정하자. 철수는 이미 서로 색이 다르다는 것을 검증한 공 한 쌍을 가지고 있다.(이전에 앞의 증명을 이용해 검증을 마쳤다고 하자. 물론 서로 색이 다르다는 것만 알 뿐 어떤 공이 빨간색인지는 알 수 없다.) 이제 다음 네 단계로 이루어진 프로토콜을 원하는 만큼 반복하면 새로 주어지는 두 공의 색이 같다는 것을 증명할 수 있다.

---

1. 철수가 이미 검증된 한 쌍의 공과 새로 주어진 한 쌍의 공에서 하나씩을 꺼내 **임의의 순서**로 영희에게 보여주면서 두 공이 같은 색인지 질문한다.

2. 철수가 다시 1단계의 과정을 반복하는데, 여기서 철수는 검증된 한 쌍의 공에서 꺼낸 공이 1단계에서 꺼낸 공과 같은 공인지 아닌지 기억한다.(검증된 한 쌍의 공이 각각 어떤 색인지는 알 수 없어도 서로 다르다는 것을 이미 알고 있으므로 같은지 아닌지는 알 수 있다. 실제 탁상에서 이 실험을 한다고 생각하면 철수 입장에서는 색을 알 수 없다고 하더라도 공을 놓아둔 위치를 통해 구분할 수 있을 것이다.)

3. 영희가 거짓말을 치는 것이 아니라면 1단계와 2단계에서 영희의 대답이 같은 경우는 각 단계에서 철수가 검증된 한 쌍의 공에서 꺼낸 공이 서로 같은 경우일 때 뿐이어야 한다. 이 외의 경우에서 1, 2단계의 대답이 동일하다면 철수는 프로토콜을 종료하고 영희가 새로 주어진 두 공이 같다는 사실을 증명할 수 없다는, 즉 증명의 효력이 없다는 판정을 내린다.

4. 철수가 영희에게 검증된 한 쌍을 넘겨 **진짜로 두 공의 색이 다른지 확인하게 한다.** 만약 철수가 전제 조건을 위반해 색이 같은 두 공을 이용했다면 영희는 자신이 새로 제시한 공에 대한 정보를 알려주지 않기 위해 프로토콜을 종료한다. 두 공의 색이 다르다면 **검증된 두 공의 순서를 임의로 바꾸어 철수에게 돌려준다.**

---

각 단계에서 굵게 쓰인 부분은 프로토콜에서 중요한 부분들을 표시해 둔 것이다. 이 부분들이 중요한 이유는 다음과 같다.

---

**1단계에서 철수가 고른 공들을 영희에게 임의의 순서로 보여주는 것** : 만약 철수가 일정한 순서, 가령 왼쪽에는 검증된 쌍에서 하나, 오른쪽에는 새로 주어진 쌍에서 하나를 보여주는 식으로 프로토콜을 진행한다면 영희가 거짓말을 치고 있을 경우 영희는 처음부터 어느 한 쪽이 검증된 쌍에서 나오는 공이라고 정하고 시작할 수 있고 그렇게 되면 영희는 50% 확률로 어느 쪽에서 검증된 공이 나오는지 맞출 수 있다. 첫 번째 프로토콜에서 영희가 잘못 골랐다면 영희의 대답에 오류가 생겨 프로토콜이 종료될 수 있지만 만약 50%의 확률로 맞춰 버린다면 문제가 생긴다. 이후에도 철수가 공을 보여주는 순서는 바뀌지 않으므로 색맹이 아닌 영희는 철수가 검증된 쌍에서 꺼내는 공을 바꿀 때마다 이를 알아챌 수 있고 결과적으로 철수를 속일 수 있다.

**4단계에서 영희가 철수가 진짜 다른 색의 공을 가지고 있는지 확인하는 것** : 만약 이 과정이 없다면 철수는 몇 번의 프로토콜을 거치며 새로 주어진 한 쌍의 공 중에서 이미 가진 같은 색깔의 두 공과 같은 색을 가진 공을 알아낼 수 있다. 물론 이 공들의 색을 알 수는 없지만 이 지식은 명백하게 영지식성을 위반한다.

**4단계에서 영희가 철수에게 검증된 두 공의 순서를 임의로 바꾸어 돌려주는 것** : 만약 이 과정이 없다면 철수는 매번 영희에게 보여주는 공들과 그에 대한 대답을 기억해서 색이 같은 세 개의 공을 알아낼 수 있다. 이를 방지하기 위해 영희가 검증된 두 공의 순서를 임의로 바꾸어줄 필요가 있다.

---

 친구가 이 전체 과정을 보고 제기한 의문은 두 가지 정도가 있었는데, 첫번째는 철수가 충분히 확신을 가질 만큼 프로토콜을 진행한 후에 갑자기 다음 프로토콜에서 2단계까지만 진행하고 도망가 버린다면 새로 주어진 공의 정보가 새어나가지 않느냐는 것이었다. 문제 설정상 가능한 상황인지는 모르겠으나 전산적으로 구현된다는 것을 가정했을 때 중간에 갑자기 프로토콜이 중단되는 일은 충분히 있을 수 있는 일이 아닌가 싶었고, 결국 이러한 경우에는 증명의 효력을 인정하지 않고 영희가 자신의 정보가 새어나갔을 가능성에 대비하게끔 하면 되지 않겠냐는 결론을 내렸다. 

두 번째는 사전에 프로토콜의 최대 진행 횟수가 정해져 있다면 4단계에서 검증된 한 쌍의 공의 순서를 영희가 뒤섞는 것은 마지막 프로토콜에서만 이루어져도 되지 않냐는 것인데, 이것은 생각해보면 이전까지 철수가 결과를 기억하고 공을 추적하더라도 마지막 프로토콜에서 그 정보들이 무용지물이 되어버리므로 사실이라는 것을 알 수 있었다. 

## 전산적인 구현
 친구와 계속해서 공을 이용한 영지식 증명에 대해 이야기를 나누면서 이것을 실제로 전산적으로 구현해서 사용할 수 있는 방법이 있을지에 대해 고민해보았고, 공의 서로 다른 색을 1비트로 간주해서 이용할 수 있지 않냐는 이야기가 나왔다. 그러나 결론은 공을 사용하는 이러한 방식은 굳이 구현해서 쓸 이유가 없다는 것이었다. 

 공을 사용하는 방식이 문제가 되는 이유는, 이를 전산적으로 구현한다면 "공의 위치를 바꾸는" 과정도 구현해야 하는데 만약 증명자가 데이터를 가지고 있다면 검증자가 공의 위치를 바꾸기 위해 검증자가 증명자의 메모리에 접근하도록 하거나 검증자가 증명자를 통해 공의 위치를 바꾸는 것을 요청하도록 해야 한다는 것이다. 

그러나 전자를 그대로 적용한다면 검증자가 영지식성을 깨뜨릴 가능성이 있으며 후자는 공의 위치 교환 여부를 증명자가 알게 되므로 증명이 의미가 없어진다. 전자의 방식을 그대로 사용하지 않고 증명자가 자신의 데이터를 암호화해서 전달하는 방식을 사용한다면 애초에 원문이 다를 경우 암호문도 다를 것이므로 굳이 영지식 증명을 사용할 필요가 없다.(두 데이터가 서로 다른지 확인할 것이라면 해시 함수를 사용하는 편이 훨씬 낫다) 신뢰할 만한 제 3자가 공의 색에 해당하는 데이터를 보관하고 공의 위치도 교환하도록 하는 방법이 있지만 이런 방식이라면 마찬가지로 굳이 영지식 증명을 쓸 필요가 없다.(탈중앙이 가능하다는 것이 영지식 증명의 장점 중 하나인데 이러한 장점을 포기한다면 굳이 영지식 증명을 쓸 필요가 없다)

실제로도 현업에서 쓰이는 영지식 증명 알고리즘에 대해 알아보니 기본적으로 두 데이터가 같다는 것(혹은 다르다는 것)을 증명하는 것과는 관련이 없고 정수론과 계산 복잡성을 활용해서 증명자가 특정한 비밀번호를 알고 있는지 검증하는 방식이었다.

물론 실용적인 목적이 아니라 시뮬레이터를 만들 목적이라면 공을 사용하는 영지식 증명을 구현해 보는 것도 굉장히 재밌을 것이다. 다음에 여유가 생긴다면 실제 테이블에서 영지식 증명을 수행하는 느낌이 들도록 두 사람이서 할 수 있는 시뮬레이터를 만들어볼 생각이다.




## 끝