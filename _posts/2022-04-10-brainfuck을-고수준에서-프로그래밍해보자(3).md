---
title: brainfuck을 고수준에서 프로그래밍해보자(3)
date: 2022-04-06 11:48:00 +0900
tags: [난해한_프로그래밍_언어, 파이썬, 프로그래밍]
---

## 서론

이제 토큰 추출은 거의 구현이 완료되었다. 추후 문법에 변경이 있다면 추가되는 부분이 있을 수 있지만 이전에 구현해둔 것에서 벗어나는 일은 크게 없을 것이다. 따라서 이제 코드 해석에 관한 부분은 구현을 살짝 미루어두고 Brainfuck 단계에서 실제 실행이 이루어지는 부분에 주목해보려고 한다.

## 내부 코드
추출된 토큰을 곧바로 Brainfuck 코드로 바꾸기는 어렵기 때문에, 먼저 내부 코드로 바꾼 후 이를 Brainfuck 코드로 바꾸는 방식을 사용할 것이다. 

사실 [이전 글](https://gabriel-dropout.github.io/posts/brainfuck%EC%9D%84-%EA%B3%A0%EC%88%98%EC%A4%80%EC%97%90%EC%84%9C-%ED%94%84%EB%A1%9C%EA%B7%B8%EB%9E%98%EB%B0%8D%ED%95%B4%EB%B3%B4%EC%9E%90(0))에서 언급했던 파이썬의 dis 모듈을 사용한 프로젝트와 유사한 방식인데, 다른 점이 몇 가지 있다면 이 프로젝트에서는 해석기를 직접 구현하였고 따라서 내부 코드 또한 직접 설계하여야 한다는 것이다. 

아마 지금까지보다 더 고된 작업이 되겠지만 직접 언어 해석기를 만들기로 한 시점부터 피할 수 없는 작업이다.

내부 코드는 파이썬이나 다른 인터프리터 언어에서 그렇듯이 인간보다는 컴퓨터의 처리 방식에 더 가까운 형태이다. 파이썬의 경우에는 스택 머신을, 루아의 경우에는 레지스터 머신을 기반으로 내부 코드를 생성하는데, 이 프로젝트의 경우에는 딱히 이러한 고려 없이 내부 코드를 설계할 것이다. 어쩌면 이 선택이 나중에 엄청난 참사로 이어지고 결과적으로는 내부 코드 부분의 구현을 싹 다 갈아엎어야 할 수도 있겠지만 이러한 선택을 하는 것에는 나름의 이유가 있다. 

바로

---
1. 스택 머신이나 레지스터 머신의 구조를 공부하기 귀찮다. 현재는 대략적인 내용만 아는 상황이기에 이것들을 채택한다면 더 세세한 부분까지 공부해야 하는데 그러다가 의욕이 떨어져서 이 프로젝트를 접게 될까 두렵다.

2. 두 구조 모두 메모리에 명령어를 저장하는 방식으로 작동하는데 이러한 방식이 마음에 들지 않는다. 이러한 방식을 사용한다면 단순 출력 코드의 경우에는 결과물이 인간이 프로그래밍한 Brainfuck 코드보다 훨씬 길어질 것 같다. 최적화에 신경을 쓰지 않기로 했지만 그렇다고 아예 시도를 안 할 수는 없다. `[` 와 `]` 를 잘 사용한다면 Brainfuck 단계에서 메모리에 명령어를 저장하는 방식을 대체할 수 있을 것이라는 생각이 든다.
---

예를 들어 다음과 같이 피보나치 수열을 구하는 OCTO 코드가 있다면

```python
func fibo(n, a, b):
	if n == 1:
		return a
	elif n == 2:
		return b
	return fibo(n - 1, b, a + b)
	
func fibonacci(n):
	return fibo(n, 1, 1)
	
func main():
	int n = int(gets())
	fib = fibonacci(n)
	puts(fib)
```

이를 다음과 같은 형태의 Brainfuck 코드로 바꿀 수 있을 것이다.

```
(대충 main 함수 내의 처리를 하는 Brainfuck 코드)
[
    (대충 fibonacci 함수 내의 처리를 하는 Brainfuck 코드)
    [
        (대충 fibo 함수 내의 처리를 하는 Brainfuck 코드)
        [
            (대충 fibo 함수 내의 처리를 하는 Brainfuck 코드)
            (대충 재귀가 정지되면 루프를 탈출하는 Brainfuck 코드)
        ]
        (대충 계산이 완료되면 루프를 탈출하는 Brainfuck 코드)
    ]
    (대충 계산이 완료되면 루프를 탈출하는 Brainfuck 코드)
]
```



위의 코드에서 루프의 탈출은 조건이 만족되었을 때 임의의 메모리를 0으로 설정하는 방식으로 이루어진다.

이제 이 대충 쓰여진 코드에 살을 붙여서 조금 더 구체적인 명령어 몇가지를 정하고 이를 Brainfuck으로 번역할 수 있는 방법을 찾아내면 된다. 아마 이 명령어(내부 코드)는 어셈블리어 느낌이 나는 형태가 될 것 같다. 나중에 Brainfuck 단계까지 건드리는 것을 감안하면 어쩌면 문자열을 자료형에 추가하고 gets()는 더 작은 함수 여러 개로 쪼개서 OCTO 안에서 구현하는 것이 더 나을지도 모르겠다는 생각이 든다.

## +
글 쓰는 것이 뜸해지고 있고 이번달도 오늘부터 한동안 바쁠 예정이라 아마 이 글 이후로 다음 글이 올라오려면 또 2~3주 정도가 걸릴 수도 있겠지만 그럼에도 불구하고 7월달이 오기 전에는 이 프로젝트를 기필코 끝내겠다는 다짐을 담으면서 이번 글을 마무리 하도록 하겠다. 그럼 오늘은 여기까지.